## 수식트리의 구현
이진트리를 이용해서 수식을 표현해 놓은 것을 가리켜 수식트리라한다.
7 + 4 * 2 - 1
위 수식은 컴파일러에의해 계산되어진다. 그방법은 인간에 의해 결정되어져 컴파일러에게 인식시킨다. 컴퓨터의 유연한 판단을 유도하는 것은 쉽지 않다. 때문에 가급적 정해진 일려의 과정을 거쳐서 수식을 인식할 수 있도록 도와야한다. 그리고 이를 위해서 수식트리라는것을 이용한다. 결론은 수식을 수식트리로 표현하면 컴파일러의 수식해석이 좋아진다. 따라서 컴파일러는 수식의 이해를 위해서 수식을 수식트리로 재표현한다.

![](https://i.imgur.com/LgHzvqF.png)

수식트리는 중위표기법,후위표기법과 같은 동등한 수식트리법을사용한다고 생각하면 된다. 먼저 그림과 같이 루트노드에 저장된 연산자의 연산을하되, 두 개의 자식노드에 저장된 두 피연산자(숫자)를 대상으로 연산을 한다. 위의 수식 트리에서는 그림에서 보이듯이 곱셈이 먼저 진행되어 그결과가 + 연산자의 오른쪽 자식 노드를 대처하게 된다. 그리고 이어서 7 + 8 연산이 진행되고, 그결과가 - 연산자의 왼쪽 자식노드를 대체한다. 마지막으로 15와 1을 대상으로 - 연산이 진행되어 최종 연산결과인 14를 얻게 된다.

이렇듯 수식트리는 우리가 보아도 연산의 순서가 명확하고, 연산의 과정을 쉽게 파악할 수 있는 이진 트리의 일종이다. 여기에서 중위 표기법의 수식을 곧장 수식트리로 표현하는것은 복잡하고 힘든일이다. 하지만 후위 표기법의 수식을 수식 트리로 표현하는 것은 비교적 간단하다. 따라서 다음의 과정을 거쳐서 수식 트리를 만들것이다.
중위 표기법의 수식 -> 후위 표기법의 수식 -> 수식 트리

전에 중위 표기법의 수식을 후위 표기법의 수식으로 바꾸는 함수를 구현해놓게있어 그것을 사용하여 중위 표기법을 후위 표기법으로 바꿀것이다. 따라서 실제 신경 쓸 것은 후위 표기법의 수식을 수식 트리로 바꾸는 일이다.

### 수식트리의 구현에 필요한 도구와 헤더파일의 정의


```c
BTreeNode * MakeExpTree(char exp[]); // 수식 트리 구성
int EvaluateExpTree(BTreeNode * bt); // 수식 트리 계산

void ShowPrefixTypeExp(BTreeNode * bt); // 전위 표기법 기반 출력
void ShowInfixTypeExp(BTreeNode * bt); // 중위 표기법 기반 출력
void ShowPostfixTypeExp(BTreeNode * bt); // 후위 표기법 기반 출력
```
BTreeNode * MakeExpTree(char exp[]); // 수식 트리 구성
이함수는 후위 표기법의 수식을 문자열의 형태로 입력받으며, 이를 기반으로 수식 트리를 구성하고 그 수식 트리의 주소값, 정확히 말해서 수식 트리의 루트 노드의 주소값을 반환한다.

int EvaluateExpTree(BTreeNode * bt); // 수식 트리 계산
이함수는 두번째 핵심이 되는 함수로써 인자로 전달된 수식 트리의 수식을 계산하여 그결과를 리턴한다.


void ShowPrefixTypeExp(BTreeNode * bt); // 전위 표기법 기반 출력
void ShowInfixTypeExp(BTreeNode * bt); // 중위 표기법 기반 출력
void ShowPostfixTypeExp(BTreeNode * bt); // 후위 표기법 기반 출력

마지막으로 수식 트리의 구성을 검증하기위해서 각각 수식 트리의 수식을 전위, 중위후위 표기법으로 출력하는 기능의 함수들이다. 이들은 트리의 순회와 관련이 있어서 그 구현은 트리를 후위 순회하면서 노드에 저장된 데이터를 출력하면 그결과가 바로 후위 표기법의 수식이 된다.

### 후위 표기법의 수식을 기반으로 수식 트리 구성하기
함수 MakeExpTree의 구현을 위해서 후위 표기법의 수식을 수식 트리로 표현하는 방법을 알아야 한다. 다음은 후위 표기법의 수식이다.
1 2 + 7 *
아래는 위 후기법을 대상으로 수식을 수식트리로 만든것이다.
![](https://i.imgur.com/azF5kJm.png)

수식 트리의 구성을 위해서는 후위 표기법의 다음 두가지 특징을 인지하고 있어야한다
* 연산 순서대로 왼쪽에서 오른쪽으로 연산자가 나열된다.
* 해당 연산자의 두 피연산자는 연산자 앞에 나열된다.

그런데 수식 트리에서는 트리의 아래쪽에 위치한 연산자들의 연산이 먼저 진행된다. 때문에 후위 표기법의 수식에서는 먼저 등장하는 피연산자와 연산자를 이용해서 트리의 하단을 만들고, 이를 바탕으로 점진적으로 트리의 윗부분을 구성해 나가야한다.

![](https://i.imgur.com/w66KVyt.png)

위의 그림에서 수식 트리를 만드는데 사용할 수식과 스택을 의미하는 쟁반이 하나 놓여 있다. 수식 트리의 구성을 위해서는 스택이 필요하다는 의미이다. 수식을 이루는 문자들을 하나씩 처리해 나가야하는데, 위의 그림에서 보이듯이 문자가 피연산자라면 이를 스택으로 옮긴다. 피연산자들은 그냥 바로바로 스택으로 옮겨주면 된다. 하지만 문자가 연산자일때는 신경 쓸 필요가 있다. 위의 마지막 그림처럼 연산자가 등장하면 스택에 쌓여있는 두개의 피연산자를 꺼내어 연산자의 자식 노드로 연결해야한다. 먼저 꺼내진 피연산자가 오른쪽 ,그다음 꺼내진 노드가 왼쪽 자식 노드이다.
![](https://i.imgur.com/AqWRDRr.png)

만들어진 수식트리를 위에 첫번째 그림처럼 다시 쟁반에 옮겨야한다. 의미적으로는 수식 트리 전부를 스택으로 옮기는 것이 되지만, 실제 코드상에서는 + 연산자가 저장된 노드의 주소 값만 스택으로 옮기면 된다. 연산자 노드에 자식노드들이 들었있기 때문이다. 쟁반으로 만들어진 수식 트리를 옮기고 계속해서 피연산자를 옮긴다. 마지막으로 나오는것이 * 연산자인데 연산자가 나오면 스택에서 다시 꺼내서 순서대로 먼저나온것이 오른쪽 왼쪽나온것이 왼쪽으로 배치되서 마지막그림의 결과가 나온다.
정리
1. 피연산자를 만나면 무조건 스택으로 옮긴다.
2. 연산자를 만나면 스택에서 두 개의 피연산자를 꺼내어 자식 노드로 연결한다.
3. 자식 노드를 연결해서 만들어진 트리는 다시 스택으로 옮긴다.
