## Spring *Service SRP를 준수하고있는가....

![](https://i.imgur.com/rnQVKeL.jpg)

Spring은 기본적으로 위의 그림과 같은 구조입니다. 특정 도메인 예를들어 User도메인이 있다고하면  기능을 구현하기 위해서는 UserService를 만듭니다. 이러한 이유는 공통비지니스 로직, 데이터베이스 접근을 해당 도메인 서비스에서 작성을 해야하기 때문입니다. 이 UserService는 크게 User도메인에 변경을 다루기위해 흐름을 제어하는 역할이라고 보시면 됩니다. 하지만 여기에서도 아래와같이 서비스를 만드는 방법은 크게 2가지가 있을 수 있습니다. 이 두개의 장단점을 설명했습니다.


### 도메인의 모든 기능을 한클래스에서 구현하는 방법
도메인의 기능을 한 서비스에서 다구현하는 방법이있습니다. 예를들어 UserService에 유저 패스워드 변경, 유저 패스워드암호 변경 등등등

**장점** : 
* 하나의 클래스에 모든 기능들이 모여 있다.

**단점** : 
* 한클래스에 너무많은 기능들이 모여있어, User에 관한 private함수들이 뒤섞여 소스 분석이 힘들다.
* 너무많은 의존성들이 하나에 클래스에 모여 있다. 
* 한 클래스 모든 테스트코드를 작성해야하기 때문에 테스트 코드를 작성하기 힘들다.
* OCP나 DIP를 준수하기위해서는 결국 메소드를 분리해낼 수 밖에 없습니다. 

해당 기능을 추상화 시킬필요가 있는데 이것은 결국 인터페이스 생성을 말합니다. 하지만 하나의 기능을 추상화하기위해 모든 유저의 기능을 추상화 할 수 없습니다. 그렇기 때문에 해당 서비스에 있는 기능을 분리해낼 수 밖에없게되는점이 있습니다. 예를들어 유저에 password변경 기능이 있다고 해보겠습니다. 
이기능은 처음에 User만 변경할 수 있었습니다. 하지만 요구사항으로 어드민도 유저에 패스워드를 변경할 수 있게 개발해달라는 요구사항이었습니다. 이렇게 되면 password변경기능을 결국 추상화하기위해 해당 UserService에서 패스워드 변경을 클래스로 분리해낼수밖에없습니다.

### 기능별로 서비스 클래스를 구현하는방법
유저의 기능이라고 해도 유저의 행위 하나하나를 클래스로 가져가는 방법.

장점 : 
* 유지보수를 할 때 하나의 클래스 로직에 집중가능하다.
* 의존성주입도 필요한 의존성들만 주입된다. 
* 테스트코드 또한 작성하기가 쉽다.
* 추가 요구사항이 들어온다고해도 그 해당 기능의기반한 클래스를 인터페이스로 바로 뽑아 낼 수 있다.

단점 : 
* 클래스가 많아진다(단점일까... 처음엔 단점이라고 생각했는데 요즘들어 그렇게 큰 단점은 아니라고 생각합니다.)


첫번째 서비스의 경우, 특정 서비스의 도메인에 관한 기능들을 만들다보면 엄청나게 서비스가 불어나게 됩니다. 

일단  개인적인 생각은 두방법다 SRP를 준수한다고 생각합니다. 그이유는 결국 유저 도메인의 상태를 변경하기위한 흐름 제어라는 책임아래 작업들을 진행하기 때문입니다. 그리고 여기에서 의존받는 데이터들은 모두 SRP를 준수하고 있다고 가정한것입니다. 어떻게보면 당연한 말일 수 도 있겠습니다. UserService는 결국 User도메인에 변경을위해 필요한 의존성들을 제어하는 역할이기 때문입니다. 물론 둘다 다른 책임들에 의존성 주입은 받아야겠지만요.  

## 외부 API 추상화
이부분은 거의 메모라고 생각합니다. 예를들어 저희가 결제 모듈을 붙이기 위해 Pg라는 파트너의 API들을 사용한다고 해보겠습니다. 문제는 이 Pg말고 Mg라는 결제모듈사도있을수 있습니다. 그럼 PgApiTemplate과 MgApitemplate은 추상화 될 수 없습니다. 그럼 어떻게 해야할까요. 바로 하나의 Service를 만들어 이것을 가공해서 리턴해주는 기능이 필요합니다. 여기에서는 PgBankService를 도메인레벨가지 끌어올린것입니다.

여기에서 외부 API자체를 추상화해서 돌려줘야한다. 안그러면 파트너사마다 리턴값이 다다르기 때문입니다.

![](https://i.imgur.com/DOIx10H.jpg)

외부 API 