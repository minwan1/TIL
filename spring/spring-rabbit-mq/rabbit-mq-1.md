# Spring Boot Rabbit MQ - 1 : Rabbit MQ 설치

# 등장배경
썬/ 오라클/IVM의 JMS와 마이크로소프트의 MSMQ등의 메시징 기술은 모두 사설 프로토콜을 썻습니다. 다른 기술이나 프로그래밍 언어를 섞어 쓰는 일은 꽤 번거러웠습니다. 이기종간에 메시지를 교환하기 위해서는 메시지 포멧 컨버전을 위한 메시지 브릿지를 이용하거나 (속도 저하 발생) 시스템 자체를 통일시켜야 하는 불편함과 비효율성이 있었다.

# AMQP
그러던중 JP모건팀이 AMQP라는 고마운 프로토콜은 내놓습니다. AMQP는 MOM의 공개 표준 애플리케이션 레어입니다. 즉, 다른 기술이나 프로그래밍 언어를 사용하기 위해 만든 연결용 프로토콜이 바로 AMQP입니다.

# Rabbit MQ
메시징 중개기의 우열은 탄탄함과 확정성을 기준으로 저울질할 수 있지만, 무엇보다 얼마나 빨리 작동하는지가 관건입니다. 가장 쓰기 편하고 확장성 좋은것은 단연 래빗 MQ이다. 래빗 MQ는 AMQP프로토콜을 구현한 메시지큐이다. 래빗 MQ의 개념과 구성요소를 얘기하자면 책한권을 고스란히 바쳐야하니 간단히 알아보자.



![Untitled Diagram](/assets/Untitled%20Diagram.jpg)







# Rabbit MQ/AMQP : 익스체인지, 바인딩, 큐
JMS 세계와 달리 AMQP는 익스체인지, 큐, 바인딩 세가지 중요 컴퍼넌트로 구성된다. 익스체인지는 발행자로부터 수신한 메시지를 큐 또는 다른 익스체인지로 보내는 라우터 역할을 한다. 이때 익스체인지는 익스체인지 타입과 바인딩이라는 몇 가지 규칙을 따르는 라우팅 알고리즘에 의해 움직인다.


| 컴포넌트  | 설명                                             |
| ----- | ---------------------------------------------- |
| 익스체인지 | 발행자로부터 수신한 메시지를 큐 또는 다른 익스체인지로 보내는 라우터 역할을 한다. |
| 큐     |   일반적으로 알고있는 큐이다. 메모리나 디스크에 메시지를 저장하고, 그것을 consumer에게 전달하는 역할을 한다. 큐는 스스로가 관심있는 메시지 타입을 지정한 Binding을 통해 exchange에 말그대로 bind된다.                                               |
| 바인딩   | exchange와 큐와의 관계를 정의한 일종의 라우팅 테이블이다. 같은 큐가 여러개의 exchange에 bind 될 수도 있고, 하나의 exchange에 여러개의 큐가 binding 될 수도 있다.                                               |




* Routing Key
  Publisher에서 송신한 메시지 헤더에 포함되는 것으로 일종의 가상 주소라고 보면 된다. Exchange는 이것을 이용해서 어떤 큐로 메시지를 라우팅할지 결정할 수 있다. (이것을 사용하지 않고 다른 룰을 이용할 수도 있음) AMQP의 표준 exchange type은 이 라우팅 키를 이용하도록 되어있다.

* Standard Exchange Type
  대부분의 MQ에서 가능한 여러가지 상황에 대하여 AMQP에서 정의한 표준 라우팅 알고리즘이다. 아래 별도 항목을 참고.


#  AMPQ프로토콜의 익스체인지 타입

AMPQ프로토콜의 익스체인지 타입은 **기본, 직접, 팬아웃, 토픽, 헤더**등 다섯가지가 있습니다.

![AMQP익스체인지:바인딩:큐](/assets/AMQP익스체인지:바인딩:큐.png)

**핵심은 라우팅 키와 함께 메시지를 익스체인지로 보내면 익스체인지 타입별로 메시지를 큐로 보낸다는것이다.(라우팅키가 맞지않으면 배달하지 않는다)**


| 컴포넌트      | 설명                                                      |
| --------- | ------------------------------------------------------- |
| 기본익스체인지   | 발행자로부터 수신한 메시지를 큐 또는 다른 익스체인지로 보내는 라우터 역할을 한다.          |
| 직접 익스체인지  | 라우팅 키와 큐를 1대1 바인딩합니다.                                   |
| 토픽 익스체인지  | 토픽 익스체인지는 직접 익스체인지와 비슷하나, 라우팅 키에 와일드카드를 추가해서 바인딩할 수 있다. |
| 헤더 익스체인지  | 헤더 익스체인지는 메시지 헤더에 따라 바인딩하는 기능을 더했습니다.                   |
| 팬아웃 익스체인지 | 팬아웃 익스체인지는 메시지를 바인당한 큐 전체에 복사한다. 말하자면 메시지를 방송하는셈이다.   |

예제에서는 기본 익스체인지 타입을 쓸거라서 라우팅키는 큐 이름과 같습니다. 따라서 래빗 MQ는 큐를 생성할 때마다 기본 익스체인지(실제 이름은 빈문자열) 와 큐를 큐이름으로 바인딩합니다.



##
AMQP의 라우팅 모델은 Exchange와 Queue 그리고 Binding으로 구성된다. 

Exchange는 Publisher(Producer)로부터 수신한 메시지를 큐에 분배하는 라우터의 역할을 하며, Queue는 메시지를 메모리나 디스크에 저장했다가 Consumer에게 메시지를 전달하는 역할을 한다. Binding은 Exchange와 Queue의 관계를 정의한 것을 말한다.

Exchange Type은 메시지를 어떠한 방법으로 라우팅할지 결정하는 일종의 알고리즘을 말하며 AMQP에서는 다음과 같이 Exchange Type을 정의하고 있다.




![Untitled Diagram](https://i.imgur.com/LnZfQHB.png)



[출처] RabbitMQ와 Spring AMQP를 이용한 간단한 작업 큐 만들기|작성자 개발몬스터


https://tmondev.blog.me/220419853534


![](https://zetawiki.com/wiki/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8_RABBIT_%ED%94%84%EB%A1%9C%ED%8D%BC%ED%8B%B0)