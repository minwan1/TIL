#메시징 큐 

# 메시지 큐 장점

메시지 큐의 장점:
비 동기(Asynchronous) : Queue에 넣기 때문에 나중에 처리 할 수 있다.
비 동조(Decoupling) : 애플리케이션과 분리 할 수 있다.
탄력성(Resilience) : 일부가 실패 시 전체에 영향을 받지 않는다.
과잉(Redundancy): 실패 할 경우 재실행 가능
보증(Guarantees): 작업이 처리된 걸 확인 할 수 있다.
확장성(Scalable): 다수의 프로세스들이 큐에 메시지를 보낼 수 있다.


# Spring boot와 래빗 mq

썬/ 오라클/IVM의 JMS와 마이크로소프트의 MSMQ등의 메시징 기술은 모두 사설 프로토콜을 썻습니다. 필자 기억에 JMS는 인터페이스 API를 정의하긴 했지만, 다른 기술이나 프로그래밍 언어를 섞어 쓰는 일은 꽤 번거러웠습니다.

# AMQP
그러던중 JP모건팀이 AMQP라는 고마운 프로토콜은 내놓습니다. AMQP는 MOM의 공개 표준 애플리케이션 레어입니다. 즉, 다른 기술이나 프로그래밍 언어를 사용하기 위해 만든 연결용 프로토콜이 바로 AMQP입니다.

# Rabbit MQ
메시징 중개기의 우열은 탄탄함과 확정성을 기준으로 저울질할 수 있지만, 무엇보다 얼마나 빨리 작동하는지가 관건입니다. 가장 쓰기 편하고 확장성 좋은것은 단연 래빗 MQ이다. 래빗 MQ는 AMQP프로토콜을 구현한 메시지큐이다. 래빗 MQ의 개념과 구성요소를 얘기하자면 책한권을 고스란히 바쳐야하니 간단히 알아보자.

# 관리자기능


# 래빗  MQ설치하기
MAC기준

```
brew upgrade
brew install rabbitmq
```

```
# Open the file
nano ~/.bash_profile
 
# Add this additional line into it and save
export PATH=$PATH:/usr/local/sbin
```

모니터링 플러그인 추가(rabbitmq cmd )
```
rabbitmq-plugins enable rabbitmq-management
```


```
$ rabbitmq-server
```


```
http://localhost:15672 (guest / guest )
```

![스크린샷 2018-08-02 오후 2.33.59](/assets/스크린샷%202018-08-02%20오후%202.33.59.png)







# Rabbit MQ/AMQP : 익스체인지, 바인딩, 큐
JMS 세계와 달리 AMQP는 익스체인지, 큐, 바인딩 세가지 중요 컴퍼넌트로 구성된다. 익스체인지는 발행자로부터 수신한 메시지를 큐 또는 다른 익스체인지로 보내는 라우터 역할을 한다. 이때 익스체인지는 익스체인지 타입과 바인딩이라는 몇 가지 규칙을 따르는 라우팅 알고리즘에 의해 움직인다.


| 컴포넌트  | 설명                                             |
| ----- | ---------------------------------------------- |
| 익스체인지 | 방해자로부터 수신한 메시지를 큐 또는 다른 익스체인지로 보내는 라우터 역할을 한다. |
| 큐     |                                                |
| 바인딩   |                                                |


AMPQ프로토콜의 익스체인지 타입은 **기본, 직접, 팬아웃, 토픽, 헤더**등 다섯가지가 있습니다.

![AMQP익스체인지:바인딩:큐](/assets/AMQP익스체인지:바인딩:큐.png)

**핵심은 라우팅 키와 함께 메시지를 익스체인지로 보내면 익스체인지 타입별로 메시지를 큐로 보낸다는것이다.(라우팅키가 맞지않으면 배달하지 않는다)**


| 컴포넌트      | 설명                                                      |
| --------- | ------------------------------------------------------- |
| 기본익스체인지   | 방해자로부터 수신한 메시지를 큐 또는 다른 익스체인지로 보내는 라우터 역할을 한다.          |
| 직접 익스체인지  | 라우팅 키와 큐를 1대1 바인딩합니다.                                   |
| 토픽 익스체인지  | 토픽 익스체인지는 직접 익스체인지와 비슷하나, 라우팅 키에 와일드카드를 추가해서 바인딩할 수 있다. |
| 헤더 익스체인지  | 헤더 익스체인지는 메시지 헤더에 따라 바인딩하는 기능을 더했습니다.                   |
| 팬아웃 익스체인지 | 팬아웃 익스체인지는 메시지를 바인당한 큐 전체에 복샇빈디ㅏ. 말하자면 메시지를 방송하는셈이다.   |

예제에서는 기본 익스체인지 타입을 쓸거라서 라우팅키는 큐 이름과 같습니다. 따라서 래빗 MQ는 큐를 생성할 때마다 기본 익스체인지(실제 이름은 빈문자열) 와 큐를 큐이름으로 바인딩합니다.
