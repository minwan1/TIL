### 1.2 DAO 분리

#### 1.2.1 커넥션만들기의 추출
앞에서 만든 UserDao소스를 본다면 시니어개발자들은 아마 많이 당황해할 것이다. 사람을 당황하게 하는 소스이기 때문이다. 그래서 이난감한 소스를 앞으로 고쳐나갈것이다.

먼저 중복된 코드가 무엇인지에대해 생각하여야한다. 먼저 앞에서 만든 UserDao의 중복코드를 제거하기 위해서 관심사항들을 뽑아보자.

* DB와 연결을 위한 커넥션을 가져오는 부분이다.
* 사용자 등록을 위해 DB에 보낼 SQL 문장을 담을 Statement를 만들고 실행하는 것 또한 계속 중복되고 있다.
* 셋째는 작업이 끝나고 리소스들을 종료해주는 부분이다.

먼저 DB와 연결을 위한 커넥션 부분을 제거해보자. getConnetion 메소드로 빼서 연결이 필요할때는 그메소드를 호출하는것이다.
```java
public User get(String id)  throws ClassNotFoundException,SQLException{
  Connection c = getConnetion();
}

private Connection getConnection() throws ClassNotFoundException,SQLException{
  class.forName("com.mysql.jdbc.Driver");
  Connection C = DriverManager.getConnection("jdbc:mysql://localhost/springbook","spring",book);
  return c
}
```
위에 getConnection메소드는 관심의 종류에 따라 메소드 구분 해놓았다. 그렇기 때문에 한가지 관심 예를들어 데이터베이스의 종류를 바꾸는 등의  문제에서 하나의 메소드에 소스만 변경하게 되면 손쉽게 데이터 베이스를 변경할 수 있게 해준다. 기존 소스같은경우에는 스키마등이 변경된다고 치면 모든 스키마 URL등을 변경해줘야 했을것이다.

#### 1.2.2 DB커넥션 만들기의 독립
이번에는 좀더 변화를 반기는 DAO를 만들것이다.
##### 상속을 통한 확장
![](https://i.imgur.com/Ux1nXhz.png)
위그림과 같이 UserDao를 추상클래스로 선언 하면 좀더 확장성 있는 소스가 될 것이다. 이렇게 선언하게되면 추상클래스에 add와 get만 메소드를 구현하고 getConnection은 깡통메소드로 나두게되면 NUserDao,DUserDao에서 getConnection만 구현하게되면 2개의 각기 다른 디비를 붙일 수 있다. 이렇든 UserDao와같은 슈퍼클래스는 기본적인 로직의 흐름(커넥션가져오기,sql생성,실행,반환)만들고 서브클래스는 메소드를 구현하는 패턴을 템플릿 메소드 패턴이라고 한다. 템플릿 메소드 패턴은 스프링에서 애용하는 패턴이다.
