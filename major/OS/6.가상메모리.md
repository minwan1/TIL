# 메모리관리

## 논리적 주소(Logical address)
* 프로세스마다 독립적으로 가지는 주소 공간
* 각프로세스마다 0번지부터 시작
* CPU가 보는 주소는 logical address임.

## 물리적 주소(Physical address)
* 메모리에 실제 올라가는 위치


## 주소 바인딩
Symbolic Address -> Logical Address ->(이시점이 언제인가) Physical address
쉽게 프로그래머가 개발을할 때 값이나 함수를 변수에 저장하는것과 같은 이치이다.

![](https://i.imgur.com/bh50SQs.png)

### 컴파일 시점 바인딩
* 컴파일러시에 logical 어드레스기반으로 그대로 물리적 메모리에 올라간다.(그렇기 떄문에 요즘 사용하지 않는다.)
* 물리적 메모리 주소가 컴파일 시 알려짐
* 시작 위치 변경시 재컴파일

* **컴파일러는 절대 코드 생성**

### 로더의 책임하에 물리적 메모리 주소 부여
위에 load time binding을 보면 로지컬 주소 0번지를 물리적 메모리주소 500번에 올리고있는 모습을 볼 수 있다.

* Loader의 책임하에 물리적 메모리 주소부여
* 컴파일러가 재배치 가능코드를 생성한 경우 가능


### 프로세스가 실행중에 메모리 상 위치를 옮길 수 있음.
* 수행이 시작된 이후에도 프로세스의 메모리 상 위치를 옮김


###

CPU는 물리적 주소를 바라볼 것 같지만 논리적 주소를 바라본다.

## Memory - Management Unit (MMU)
CPU가 메모리에 접근하는 것을 관리하는 컴퓨터 하드웨어 부품이다. 이것은 주소 변환을 위한 하드웨어를 말한다. CPU는 논리적 주소를 기반으로 주소를 호출하는데 이것을 물리적 주소로 변환해주는것이 MMU의 역할이다.

![](https://i.imgur.com/EOTw97D.png)


### MMU(Memory-Management Unit)
* logical address를 physical address로 매핑해 주는 Hardware device



### MMU scheme
* 사용자 프로세스가 CPU에서 수행되며 생성해내는 모든 주소값에 대해 base register의 값을 더 한다.

### User Program
* logical address 만을 다룬다.
* 실제 physical address를 볼 수 없으면 알필요가 없다.





## Dynamic Loading
프로세스 전체를 메모리에 미리 다올리는것이 아니라 해당 루틴이 불렬질 때 메모리에 load하는것 



## 페이징 시스템
메모리에 필요하면 기능들을 올려놓고 필요없으면 다시 내려놓는것을 페이징 시스템이라한다. 이러한것은 운영체제가 관리한다.


## Swapping
프로세스를 일시적으로 메모리에서 하드디스크(backing store)로 쫒아 내는것.
**Swap in**
하드디스크에서 프로세스를 다시 메모리에 올려놓는것.
**Swap out**
프로세스를 하디스크로 잠시 뺴놓는것.


## 페이징 
Process의 virtual memory를 동일한 사이즈의 단위로 나눔
Virtual memory의 내용이 page 단위로 불연속적으로 저장됨.
일부는 backing sotrage(하드디스크), 일부는 물리적 저장소에 둔다.

### 페이지 테이블
논리적인 주소가 물리적 주소어디에 있는지 관리해주는 자료구조이다. 페이지테이블은 메인메모리에 존재한다. 페이지 테이블은 프로세스마다 하나씩 존재하게 되며, 메인 메모리 (RAM)에 상주하게 된다.
![](https://i.imgur.com/KCVIGbQ.png)


 예를들어 운영체제가 32비트라고하면 메모리에서 표현할 수 있는 값이 최대 2*32(4GB)만큼 공간을 표현할 수 있다.




![](https://i.imgur.com/xVpR5cn.png)


다음 그림을 설명하면 다음과 같을 수 있다. CPU가 논리적 메모리 주소로 접근하면 논리적 메모리는 페이지 테이블을 통해 물리적 메모리를 참조한다. 만약 이과정속에서 페이지 테이블에 메모리 정보가 invalid로 되어있다면 이것을 이제 `페이지 폴트`라고한다. 이것은 물리적 메모리에 코드가 없는것이기 때문에 시스템 트랩을 발생하여 스왑공간 즉 하드디스키인 백킹스토어에 요청하여 메인메모리에 해당 코드를 올린다. 




