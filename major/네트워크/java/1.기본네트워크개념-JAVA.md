# 기본 네트워크 개념
* 텍스트 편집기는 FTP(FIileTransferProtocol) 서버로부터 직접 파일을 열거나 저장할 수 있다.
* 개발도구로 gitub와같은 소스코드 저장소와 통신할 수 있다.
* 게임을 하다보면 실시간으로 대화를 한다.

## 네트워크
### 네트워크
네트워크는 실시간으로 서로 데이터를 주고 받을 수 있는 컴퓨터 및 다른 장치들의 집합이다. 네트워크는 선으로 혹은 무선으로 연결되어있으며, 데이터 비트는 전기신호로 반환되어 선을 타고 이동한다. 반면 네트워크는 전파를 사용하여 데이터를 전송한다. 


### 노드
네트워크안에서 연결되어지는 장비를 노드라고 한다. 일반적으로 노드는 컴퓨터를말하지만, 프린터, 라우터, 브리지, 게이트웨이, 터미널등도 노드에 포함된다.

### HOST
노드 중에서 일반적으로 host라는 표현은 PC라고 생각하면된다.

### 네트워크 데이터 송수신

모든 네트워크 노드는 네트워크 안에서 서로르 고유하게 식별하는 바이트 순서인 `주소`를 가지고 있다. 주소는 더 많은 바이트 수가 부여될수록 더 많은 주소를 이용할 수 있고 더 많은 장치가 동시에 네트워크에 연결될 수 있다.

여기에서 많은 네트워크방식이있다. 이더넷 주소는 실제 이더넷 장비에 연결이 된다. 이더넷 장비의 제조사는 그들의 장비와 다른 제조사 장비의 주소 사이의 충돌을 피하기 위해 미리할당된 제조사 코드를 사용한다. 지금 현재는 대부분 이방식을 이용한다. 이방법은 하나의 노드에 여러개의 노드가 한번에 통신하지 못한다는 특징이있다. 


모든 현대 컴퓨터네트워크는 패킷 교환방식으로 사용한다. 네트워크에서 각각의 패킷은 별도처리되는데 송신자의 정보와 수신자의 정보가 담겨 있다. 


## 네트워크 계층
네트워크를 통한 전송은 데이터의 논리적인 특성뿐만 아니라 네트워크의 물리적 특성까지 고려하여 주의 깊게 다뤄야하는 매우 복잡한 작업이다. 
네트워크로 데이터를 전송하는 소프트웨어는 패킷의 충돌을 피하는 방법, 디지털 데이터를 아날로그 데이터로 바꾸는방법, 에러를 발견하고 정정하는방법, 패킷의 전송 겨로를 설정하는방법들을 알아야한다. 이러한 과정은 여러 운영체제와 이종 네트워크 회선의 지원에 대한 요구가 추가될 때 더욱 복잡해진다. 

이러한 복잡한 과정등을 추상화하여 몇개의 계층으로 나눴다. 이것이 OSI7계층이다. 네트워크를 몇개의 게층으로 분리함으로써 계층 간 인터페이스가 변경되지 않는 한 하나의 계층안에 있는 소프트웨어를 다른 계층에 미치는 영향 없이 수정하거나 대체할 수 있다.



![](https://i.imgur.com/9QStTo5.png)

|레벨 | 계층 | 기능|
|---|----|---|
|7계층 Application |응용 계층 프로토콜 : DHCP, DNS, FTP, HTTP 서비스 제공 | 사용자가 네트워크에 접근할 수 있도록 해주는 계층이다. 사용자 인터페이스, 전자우편, 데이터베이스 관리 등 서비스를 제공한다. 예로, 텔넷이나 HTTP, SSH, SMTP, FTP 등을 들 수 있다. |
|6계층 Presentation | 표현 계층 프로토콜 : JPEG, MPEG, SMB, AFP 이해할 수 있는 포멧변환 | 운영체계의 한 부분으로 입력 또는 출력되는 데이터를 하나의 표현 형태로 변환한다. 필요한 번역을 수행하여 두 장치가 일관되게 전송 데이터를 서로 이해할 수 있도록 한다. 제어코드나 문자 및 그래픽등의 확장자(jpg, gif, mpg)를 생각하면 쉽다. |
|5계층 Session |세션 계층 프로토콜 : SSH, TLS 응용간의 질서 제어 | 통신 세션을 구성하는 계층으로, 포트(Port)연결이라고도 할 수 있다. 통신장치 간의 상호작용을 설정하고 유지하며 동기화 한다. 사용자간의 포트연결(세션)이 유효한지 확인하고 설정한다. |
|4계층 Transport | 전송 계층 프로토콜 : TCP, UDP, ARP 장비 : 게이트웨이 | 전체 메시지를 발신지 대 목적지(종단 대 종단)간 제어와 에러를 관리한다. 패킷들의 전송이 유효한지 확인하고 실패한 패킷은 다시보내는 등 신뢰성 있는 통신을 보장하며, 머리말에는 세그먼트(Segment)가 포함된다. 대표적인 프로토콜은 TCP이다.|
|3계층 Network | 네트워크 계층 프로토콜 : IP, ICMP, IGMP 장비 : 라우터 | 다중 네트워크 링크에서 패킷(Packet)을 발신지로부터 목적지로 전달할 책임을 갖는다. 2계층은 노드대노드 전달을 감독하는 것이고 3계층은 각 패킷이 시작 시점에서 최종 목적지까지 성공적이고 효과적으로 전달되도록하며, 대표적 프로토콜은 IP이다.|
|2계층 Data link | 데이터링크 계층 프로토콜 : MAC, PPP 장비 : 브리지, 스위치| 오류없이 한 장치에서 다른 장치로 프레임(Frame, 비트의 모음)을 전달하는 역할 스위치같은 장비의 경우 MAC주소를 이용하여 정확한 장치로 정보 전달 3계층에서 정보를 받아 주소와 제어정보를 시작(헤더)와 끝(테일)에 추가|
|1계층 Physical | 물리계층 프로토콜 : Ethernet.RS-232C 장비 : 허브, 리피터| 물리적 매체를 통해 비트(Bit)흐름을 전송하기 위해 요구되는 기능들을 조정 케이블, 연결 장치 등과 같은 기본적인 물리적 연결기의 전기적 명세를 정하고 네트워크의 두 노드를 물리적으로 연결시켜 주는 신호방식을 다름|

다음은 위에 7계층을 tcp/ip계층으로 나타내면 아래의 4계층으로 표현할 수 있다.


![](https://i.imgur.com/PGhkkCW.png)

레벨 | 계층 | 기능|
---|----|---|
|4계층 Application |응용 계층프로토콜(애플리케이션 계층) : HTTP, FTP, Telnet, DNS, SMTP |OSI 7계층의 5, 6, 7계층에 해당한다. TCP/IP 기반의 응용프로그램을 구분할 때 사용한다. |
|3계층 Transport |전송 계층프로토콜 (전송계층) : TCP, UDP |OSI 7계층의 4계층에 해당한다.통신 노드 간의 연결을 제어하고, 자료의 송수신을 담당한다. |
|2계층 Internet |인터넷 계층프로토콜 (인터넷 계층): IP, ARP, RARP, ICMP, OSPF |OSI 7계층의 3계층에 해당한다.통신 노드 간의 IP 패킷을 전송하는 기능 및 라우팅 기능을 담당한다. |
|1계층 Network Interface |네트워크 인터페이스 계층프로토콜 (호스트 투 네트워크 계층) : Ehternet, Token Ring, PPP |OSI 7계층의 1, 2 계층에 해당한다.CSMA/CD, MAC, LAN, X.25, 패킷망, 위성 통신, 다이얼 업 모뎀 등 전송에 사용된다. |


4계층 모델을기반으로 어떻게 각각의 계층들이 동작되는지 알아보자. 크롬, 파이어폭스등은 애플리케이션 계층에서 실행되고 전송 계층이랑만 대화를 한다 전송 계층은 위아래오 존재하는 예플리케이션과 인터넷 계층하고 대화를 한다. 인터넷 계층은 호스투네트워크 계층과 네트워크 전송계층하고 대화를 하며 애플레키엿ㄴ 계층과 직접 대화하지는 않는다. 호스트 투 네트워크 계층은 회서, 광케이블같은 매체를 통해 다른 시스템의 호스트 투 네트워크로 데이터를 이동 시킨다. 그리고 이동된 데이터는 다시 원격 시스템의 애플리케이션 계층으로 전달된다.

이렇게 각 계층별로 역할을 나누어 놓은 이유는 기능들을 캡슐화, 추상화를 위해서이다. 만약 이렇게 계층들을 나누지 않고 관리하게된다면 에러등 문제가 발생 햇을때 추적하기가 힘들기 때문입니다. 위에서 간단하게 계층을 나눴지만 각계층들은 세부적으로보면 실제로는 훨씬 더 복잡한일들을 하고 있습니다. 또한 이렇게 계층으로 나눔으로써 각 계층은 자기가와 관련된 계층에만 신경쓰게 되어졌습니다. 


### 호스트 투 네트워크 계층
호스트 누 네트워크 계층은 이더넷 카드나 와이파이 안테나 같은 특정 네트워크 인터페이스가 물리적인 연결을 통해 로컬 네트워크 및 외부로 IP 데이터 그램을 보내는 방법을 정의한다.
호스투네트워크는 하등웨어로 구성되며, 때로 네트워크 물리 계층이라고 불린다. 프로그래머로서 누군가 이 하드웨어로 구성된 선을 짜르지 않는 이상 애플리케이션 프로그래머는 여기에 크게 신경쓸필요는 없다.

### 인터넷 계층
프로그래머가 첫번째로 관심을둬야할 계층이자 호스투네트워크 다음 계층인 인터넷 계층이다. 네트워크 계층 프로토콜은 데이터의 비트와 바이트를 좀 더 큰 그룹인 패킷으로 구성하는 방법과 다른 컴퓨터가 서로를 찾을 수 있도록 주소 체계를 정의한다.

IP에는 크게 2가지 종류 32비트 주소를 사용하는 IPv4와 128비트 주소와 패킷의 경로 탐색을 돕기위한 몇가지 기술적인 요소들을 포함 IPv4가 있다. IPv4와 IPv6 모두에서 데이터는 데이터그램이라는 패킷으로 인터넷 계층을 통해 보내진다. IPv4 데이터그램은 20바이트~60바이트의 헤더 최대 65515바이트의 페이로드를 포함한다. IPv6는 좀더 큰헤더와 최대 4G의 페이로드를 포함할 수 있다.

![download](/assets/download.png)

인터넷 계층은 라우팅 및 주소지정외에, 다른 종류의 호스투-투-네트워크 계층이 서로 통신할 수 있게한다. 예를들어 무선랜과 이더넷등간의 프로토콜을 변환한다. 인터넷계층과 같은 유사한 계층이 없다면 각 컴퓨터는 공유 가능한 특정 네트워크 유형(이더넷,무선랜,광섬유) 하고만 통신이 가능할것이다.

### 전송 계층 
데이터 그램 자체에는 몇가지 단점이 존재한다. 
* 데이터그램은 목적지 까지 전송을 보장하지 않는다.
* 목적지까지 전송되더라도 데이터는 손상되있을 수 있다.(헤더체크섬은 헤더의 손실만 체크할뿐 데이터의 손상은 확인하지 않는다.)


전송 계층은 패킷이 손실되거나 손상되지 않고 보낸 순서대로 수신되도록 보장할 책임이 있다. 만약 패킷이 손상된다면 전송계층은 송신자에게 다시 데이터를 요청할 수 있다. IP네트워크는 이러한 기능을 각각의 데이터그램에 몇명 정보를 포함하고 있는 부가적인 헤더를 추가하여 구현한다. 전송단계는 크게 2가지주요 프로토콜이 있다.

**TCP**
* 손실되거나 손상되 데이터의 재전송과 데이터의 순서를 보장하는 오버헤드가 높은 프로토콜이다.
* UDP보다 느리다.

**UDP**
* 사용자 데이터그램 프로토콜은 수신자가 패킷의소산을 감지할 수는 있지만 수신된 패킷의 순서는 보장하지 않는다. 
* 데이터의 정확성 보장하지 않는다.



### 애플리케이션 계층

사용자에게 데이터가 전달되는 계층을 애플리케이션 계층이라한다. 위에 3계층은 하나의 컴퓨터에서 다른 컴퓨터로 데이터가 전송되는 방법을 정의하기 위해 모두 함께 동작한다. 애플리케이션계층은 데이터가 전송된 후 해당 데이터로 어떤 일을할지 결정한다.

예를들어 HTTP프로토콜같은경우 전송계층을 통해 오게되면 그래픽이미지는 숫자들의 스트림이 아닌 그림으로 볼 수 있게끔 변환해주는 작업을한다. 이러한 작업은 네트워크통신에서 가장 많이 시간을 많이 소비하는 부분이다. 이외에도 SMTP, POP, IMAP등의 프로토콜이 존재한다.

### IP, TCP 그리고 UDP

#### IP 특징
IP는 두 지점 사이의 여러 경로를 허용하고 손상된 라우터 주변데이터의 패킷을 라우팅할 수 있도록 설계 되었다. 즉 어떤 라우터가 망가지더라도 그해당라우터와 네트워크만 망가질뿐 다른 라우터들과 네트워크 통신에는 영향을 미치지 않는다.
서로 다른 종류의 컴퓨터가 모두 서로 통신이 가능하다. 

#### TCP의 특징
IP(인터넷)계층만으로는 패킷들이 손상되거나 순서를 보장 받지 못한다. 이러한 IP계층의 설계를 개선하기위해 각 연결끝에 IP패킷의 수신 여부 확인 니으과 손상되거나 손실된 패킷에 대한 재전송 요청기능을 추가하는게 TCP이다.

#### UDP으 특징
TCP는 꽤 많은 오버헤드를 유발한다. 그래서 데이터의 순서가 특별힞 중요하지않고 일부 패킷이 손실이 전체 데이터 스트림을 손상싴지 않는 경우, 패킷은 종종 UDP프로토콜을 사용할 수 있다. UDP는 데이터이 손실, 순서의 보장을 해주지 않지만 TCP보다 빠르다. 그렇기 때문에 이러한 데이터의 손실, 순서보장이 필요없는 비디오 재생, 오디오 재생등에서 사용할 수 있다.

#### IP주소와 도메인
**IPv4**
현재 IP 주소체계는 크게 IPv4(Internet protocol version 4)방식과 IPv6(Internet protocol version 6)방식이 존재한다. IPv4는 4바트로 구성되어 있으며 각각의 바이트들은 점으로 구분되 4개의 숫자형식으로 표시된다. 예를들어 192.0.0.255 로 구성될 수 있다. 총 IPv4 는 40억개(2^32)개가 할당될어질수 있다.
**IPv6**
IPv4만으로는 지구에 모든 네트워크 장비들에게 IP를 할당할 수 없어서 나온것이 IPv6 이다. IPv6는 16이트 주소체계를 가지고 있으며 총(2^128)개의 IP를 할당할 수 있다. 현재 휸대폰및 컴퓨터등에 장비에 할당되어져 사용되고 있다.

**DNS**
인터넷에접속하기위해서는 해당 서버에 IP를 기반으로 접속하게 될것이다. 하지만 IP주소는 숫자로 구성되어져있기 때문에 외우기가 힘들다는 단점이 있다. 그래서 이것을 문자로 관리할 수 있게해주는것이 Domain name system이다.

예를들어 www.naver.com 를 입력하게되면 중간에 도메인 서버를 두어서 이것을 해당 서버에 IP롤 변경하여 접속하게해주는것이 Domain name system이다. 자바 프로그램은 네트워크에 접근할 때 숫자로 된 주소와 이에 대응하는 호스트네임을 모두 처리해야하며, 이것을 처리하는 방법은java.net.InetAddress클래스에서 제공된다.

#### 포트
컴퓨터가 동시에 하나 이상의 프로그램을 실행할 수 없다면 IP 주소만 알아도 문제가 없다. 하지만 하나의 서버로 FTP요청을 처리하면서 웹트래픽을 처리할 수 도 있다. 이러한작업은 포트를 통해 가능해진다. IP가 할당된 컴퓨터는 수천개이사으이 논리적인 포트를 사용할 수 있다. 포트는 1~65535까지의 숫자로 표혀되며 각포트는 특정서비스에 할당될 수 있다.

데이터가 특정 IP가 할당된 특정 장비에서 실행중인 웹서버로 보내질 때, 데이터는 또한 해당 장비의 특정 포트로 보내진다. 데이터를 수신한 장비는 포트를 검사하기위해 각각의 패킷을 검사하고 해당 포트로 수신을 기다리고 있는 프로그램으로 데이터를 전달한다.

>리눅스 맥운영체제는 루트권한으로 실행된 포트만이 데이터를 수신할 수 있다. 반면윈도우는 특별한 권한없이 어떠한 프로그램이라도 이범위의 포트를 사용할 수 있다.

#### 인터넷
인터넷은 세상에서 가장큰 IP기반 네트워크다. 인터넷은 일곱 대륙의 수많은 컴퓨터들이 IP프로토콜을 기반으로 대화할 수 있게해준다.

#### 네트워크 주소 변환
IP주소의 결핍과 요구가 증가함에 따라 오늘날 대부분의 네트워크에서는 네트워크 주소변환(NAT)기술을 사용한다. NAT 기반의 네트워크에서 대부분의 노드들은 라우팅 되지 않는 10.x.xx, 172.31.x.x 그리고 192.168.x.x의 로컬주소들중 하나를 선택하여 사용한다. 로컬 네트워크를 ISP(Internet Service provider)로 연결하는 라우터나 허브는 이러한 공인 IP를 몇개의 로컬주소로 변환한다.

그렇기때문에 만약 라우터를 이용해 사설 IP를 할당받았다면 서버를 운영하기위해서는 해당 라우터의 NAT [Network Address Translation] 설정을 해줘야한다. 그 라우터는 공인 IP를 받았아서 사설 IP를 구성했기 때문이다. 그렇기때문에 특정 공인 IP로 요청이들어오면 수신하고자하는 사설 IP롤 변경하는 작업을 해줘야 서버를 구성할 수 있다.

#### 방화벽
인터넷상에서 해킹을 시도하는 사람은 많다. 이러한 시도를 막기위해 로컬네트워크와 단일 접근 지점을 만들고, 단일 접근 지점을 오가는 모든 트래픽을 검사하는것이 도움이된다. 인터넷과 로컬네트워크 사이에 위치하여 들어오고 나가는 모든 데이터를 검사하는 하드웨어와 소프트웨어를 **"방화벽"**이라고 부른다. 


### 프록시 서버
프록시 서버는 내부와 외부 사의 중계자 역할을 한다. 방화벽이 로컬 네트워크안의 호스트가 외부 세상으로 직접 연결하는것을 금지하면 프록시 서버는 내부와 외부 사이의 중계자 역할을한다.

프록시서버를 이용하면 한가지이점은 내부시스템을 해킹하기 어렵게 만든다는 장점이 있다. 방화벽이 일반적으로 전송계층이나 인터넷 계층에서 동작하는 반면에, 프록시 서버는 일반적으로 애플리케이션 계층에서 동작한다. 프록시서버는 HTTP나 FTP같은 애플리케이션 수준의 프로토콜에 대해 매울 잘알 고 있다.

### 클라이언트/서버 모델
대부분의 최신 네트워크 프로그래밍은 클라이언트/서버 모델로 운영된다. 가장 많이 쓰이는 모델은 엔진엑스 혹은 아파치를 기반에 웹서버를 두고 크롬이나 파이어폭스등의 웹클라이언트가 요청을 보내면 요청에 응답하는 구조로 많이 쓰인다. 
그런데 모든 애플리케이션이 서버/클라이언트 구조로 적합한한것은 아니다. 예를 들어, 일부 네트워크 게임에서는 두 게이머가 서로 연결되어 데이터를 주고 받는다. 이러한 연결 종류를 P2P(peer-to-peer)라고하는데 전화 시스템과 비슷하다.

자바 자체의 네트워킹 API에서는 명시적으로 P2P통신을 위한 기능을 제공하지 않는다. 그러나 애플리케이션들은 몇 가지 방법으로 어렵지 않게 P2P 통신 기능을 제공할 수 있다.
1. 애플리케이션이 서버와 클라이언트 역할을 모두 수행하는 방법이 있다.
2. 피어간에 데이터를 전달해주는 중개서버프로그램을 이용해 통신하는 방법이 있다.





| OSI 7 Layer                          | PDU (Protocol Data Unit) |
|--------------------------------------|--------------------------|
| Application / Presentation / Session | Data                     |
| Transport                            | Segment                  |
| Network                              | Packet or Datagram       |
| Data Link                            | Frame                    |
| Physical                             | Bit                      |




 

 

 








 

 
